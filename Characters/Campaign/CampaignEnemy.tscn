[gd_scene load_steps=10 format=3 uid="uid://la6he6vwubnb"]

[ext_resource type="PackedScene" uid="uid://1s5qidco641t" path="res://Characters/CharacterBase.tscn" id="1_rf7ub"]
[ext_resource type="Script" path="res://Characters/Campaign/CampaignEnemy.gd" id="2_pqw3d"]
[ext_resource type="PackedScene" uid="uid://cy12nf62sv60i" path="res://Debug/VectorCube.tscn" id="3_3vsup"]
[ext_resource type="Script" path="res://addons/StateMachine/StateMachine/state_machine.gd" id="3_7r2cl"]
[ext_resource type="Script" path="res://Characters/Campaign/GuardState.gd" id="3_h5c2t"]
[ext_resource type="PackedScene" uid="uid://bd2fp3xjnl5vp" path="res://Characters/Campaign/VisionCone.tscn" id="3_u6o4h"]
[ext_resource type="Script" path="res://Characters/Campaign/AlertState.gd" id="5_geefd"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_drlm1"]
albedo_color = Color(1, 0.725141, 0.52472, 1)
subsurf_scatter_strength = 1.0
subsurf_scatter_skin_mode = true

[sub_resource type="BoxMesh" id="BoxMesh_tvwkv"]
size = Vector3(0.5, 0.5, 0.5)

[node name="CampaignEnemy" instance=ExtResource("1_rf7ub")]
script = ExtResource("2_pqw3d")
accuracy = 1.0

[node name="NavAgent" type="NavigationAgent3D" parent="." index="0"]

[node name="StateMachine" type="Node" parent="." index="1" node_paths=PackedStringArray("initial_state")]
script = ExtResource("3_7r2cl")
initial_state = NodePath("GuardState")

[node name="GuardState" type="Node" parent="StateMachine" index="0" node_paths=PackedStringArray("enemy")]
script = ExtResource("3_h5c2t")
enemy = NodePath("../..")

[node name="AlertState" type="Node" parent="StateMachine" index="1" node_paths=PackedStringArray("enemy")]
script = ExtResource("5_geefd")
enemy = NodePath("../..")

[node name="TargetCast" type="RayCast3D" parent="." index="3"]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.65, 0)
target_position = Vector3(0, 0, -1)
collision_mask = 3
debug_shape_custom_color = Color(0, 0.54902, 0.282353, 1)

[node name="Weapons" parent="." index="4"]
transform = Transform3D(0.84751, -0.0732719, 0.525698, -0.245063, 0.824524, 0.510004, -0.47082, -0.561062, 0.680836, 0.167406, 1.45687, -0.378986)

[node name="LookHelper" type="Node3D" parent="." index="5"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.65, 0)

[node name="VisionCone" parent="LookHelper" index="0" node_paths=PackedStringArray("parent") instance=ExtResource("3_u6o4h")]
unique_name_in_owner = true
transform = Transform3D(10, 0, 0, 0, -4.37114e-07, -10, 0, 10, -4.37114e-07, 0, 0, 0)
parent = NodePath("../..")

[node name="VectorCube" parent="AimHelper" index="0" instance=ExtResource("3_3vsup")]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
visible = false

[node name="ShootCast" parent="AimHelper" index="2"]
visible = false
collision_mask = 13

[node name="Skeleton3D" parent="Puppet" index="2"]
bones/1/position = Vector3(-1.00219e-09, 0.893514, -0.0641973)
bones/2/rotation = Quaternion(-0.141715, 0.000888157, 0.00256375, 0.989904)
bones/4/rotation = Quaternion(0.0847906, 0.0131489, 0.0182244, 0.996145)
bones/5/rotation = Quaternion(-0.0203041, -0.000128765, -0.000878285, 0.999794)
bones/7/rotation = Quaternion(-0.185815, 0.255655, -0.490924, 0.811854)
bones/8/rotation = Quaternion(0.258866, 0.0352023, -0.0504066, 0.963955)
bones/9/rotation = Quaternion(-0.0130172, -0.334314, -0.0150251, 0.942252)
bones/11/rotation = Quaternion(-0.137814, -0.0285461, 0.156968, 0.977524)
bones/12/rotation = Quaternion(-0.0728706, -0.00440988, -0.0389535, 0.996571)
bones/14/rotation = Quaternion(0.063532, -0.171694, -0.0812036, 0.97974)
bones/15/rotation = Quaternion(0.0688573, 0.146545, 0.0441172, 0.985818)
bones/17/rotation = Quaternion(-0.307346, -0.0312083, 0.271765, 0.911432)
bones/18/rotation = Quaternion(-0.0645516, 0.0977242, -0.0941116, 0.988649)
bones/20/rotation = Quaternion(0.193603, 0.112679, 0.512527, 0.828938)
bones/21/rotation = Quaternion(0.698984, -0.0256257, 0.136101, 0.701599)
bones/22/rotation = Quaternion(0.142279, 0.256595, -0.060759, 0.954057)
bones/24/rotation = Quaternion(-0.134423, 0.0446834, -0.140245, 0.979931)
bones/25/rotation = Quaternion(-0.0628901, 0.0121892, 0.0253384, 0.997624)
bones/27/rotation = Quaternion(0.0972538, 0.159989, 0.107337, 0.976434)
bones/28/rotation = Quaternion(0.0910466, -0.132289, -0.0682101, 0.984661)
bones/30/rotation = Quaternion(-0.526931, -0.386486, 0.593888, 0.469328)
bones/31/rotation = Quaternion(-0.291467, -0.110498, 0.336933, 0.888433)
bones/33/rotation = Quaternion(-0.586308, 0.218931, -0.168332, 0.761562)
bones/34/rotation = Quaternion(-0.086126, 0.00386879, 0.131953, 0.9875)
bones/35/rotation = Quaternion(0.267558, -0.132589, -0.627113, 0.719418)
bones/36/rotation = Quaternion(0.00495412, -0.00577786, -0.163837, 0.986458)
bones/38/rotation = Quaternion(-0.526368, -0.0598007, 0.332877, 0.780099)
bones/39/rotation = Quaternion(-0.13045, -0.00380449, -0.199861, 0.971094)
bones/40/rotation = Quaternion(0.223119, 0.129062, 0.515003, 0.817516)
bones/41/rotation = Quaternion(0.00495411, 0.00577787, 0.163837, 0.986458)

[node name="Body" parent="Puppet/Skeleton3D" index="0"]
surface_material_override/0 = SubResource("StandardMaterial3D_drlm1")

[node name="Head" parent="Puppet/Skeleton3D" index="1"]
transform = Transform3D(-0.999989, -0.00460603, 0.000491373, -0.00461944, 0.983757, -0.179444, 0.000343137, -0.179444, -0.983768, -0.000751046, 1.57305, -0.0419195)

[node name="HeadArea" parent="Puppet/Skeleton3D/Head" index="0"]
collision_layer = 8
collision_mask = 1

[node name="Neck" parent="Puppet/Skeleton3D" index="2"]
transform = Transform3D(-0.999996, -0.00283131, 0.000384832, -0.0028468, 0.975667, -0.219237, 0.000245268, -0.219237, -0.975671, -0.000569316, 1.51043, -0.0278475)

[node name="NeckArea" parent="Puppet/Skeleton3D/Neck" index="0"]
collision_layer = 8
collision_mask = 1

[node name="Chest" parent="Puppet/Skeleton3D" index="3"]
transform = Transform3D(-0.999985, 0.00532757, -0.00103211, 0.0050378, 0.982087, 0.188362, 0.00201713, 0.188354, -0.982099, -1.90879e-09, 1.13168, -0.0868667)

[node name="ChestArea" parent="Puppet/Skeleton3D/Chest" index="0"]
collision_layer = 8
collision_mask = 1

[node name="Stomach" parent="Puppet/Skeleton3D" index="4"]
transform = Transform3D(-1, -3.78941e-09, -3.89234e-07, 3.31093e-08, 0.995501, -0.0947544, 3.87842e-07, -0.0947544, -0.995501, -1.00219e-09, 0.893514, -0.0641973)

[node name="StomachArea" parent="Puppet/Skeleton3D/Stomach" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_UpperArm" parent="Puppet/Skeleton3D" index="5"]
transform = Transform3D(0.985425, 0.165228, -0.0404656, 0.148038, -0.715761, 0.682474, 0.0838, -0.678517, -0.729789, 0.194569, 1.39371, -0.0345384)

[node name="R_UpperArmArea" parent="Puppet/Skeleton3D/R_UpperArm" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_Forearm" parent="Puppet/Skeleton3D" index="6"]
transform = Transform3D(0.964105, -0.265249, -0.0120228, 0.185698, 0.641211, 0.744557, -0.189784, -0.720063, 0.667451, 0.229047, 1.24436, -0.176126)

[node name="R_ForearmArea" parent="Puppet/Skeleton3D/R_Forearm" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_Hand" parent="Puppet/Skeleton3D" index="7"]
transform = Transform3D(0.84751, -0.0732719, 0.525698, -0.245063, 0.824524, 0.510004, -0.47082, -0.561062, 0.680836, 0.174593, 1.37599, -0.323951)

[node name="R_HandArea" parent="Puppet/Skeleton3D/R_Hand" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_UpperArm" parent="Puppet/Skeleton3D" index="8"]
transform = Transform3D(0.977001, -0.19322, 0.0902022, -0.156287, -0.936625, -0.313543, 0.145068, 0.292234, -0.94528, -0.195353, 1.39312, -0.0344923)

[node name="L_UpperArmArea" parent="Puppet/Skeleton3D/L_UpperArm" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_Forearm" parent="Puppet/Skeleton3D" index="9"]
transform = Transform3D(0.976394, -0.00889475, 0.215814, -0.0516934, -0.979739, 0.193493, 0.209721, -0.200082, -0.957071, -0.235672, 1.19767, 0.0264887)

[node name="L_ForearmArea" parent="Puppet/Skeleton3D/L_Forearm" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_Hand" parent="Puppet/Skeleton3D" index="10"]
transform = Transform3D(0.893924, 0.024131, -0.447569, 0.101078, -0.983681, 0.148846, -0.436673, -0.178297, -0.881775, -0.237498, 0.996539, -0.0145867)

[node name="L_HandArea" parent="Puppet/Skeleton3D/L_Hand" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_Thigh" parent="Puppet/Skeleton3D" index="11"]
transform = Transform3D(0.48733, 0.060411, 0.871126, -0.299588, -0.925487, 0.231778, 0.820217, -0.373932, -0.432919, 0.0851499, 0.876024, -0.0593682)

[node name="R_ThighArea" parent="Puppet/Skeleton3D/R_Thigh" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_Shin" parent="Puppet/Skeleton3D" index="12"]
transform = Transform3D(0.476854, 0.0237958, 0.87866, 0.0964784, -0.995011, -0.0254127, 0.873671, 0.09689, -0.476771, 0.110532, 0.487172, -0.216479)

[node name="R_ShinArea" parent="Puppet/Skeleton3D/R_Shin" index="0"]
collision_layer = 8
collision_mask = 1

[node name="R_Foot" parent="Puppet/Skeleton3D" index="13"]
transform = Transform3D(0.245939, 0.0720783, 0.966602, -0.853541, -0.456466, 0.25121, 0.459327, -0.886817, -0.0507408, 0.119461, 0.113837, -0.180125)

[node name="R_FootArea" parent="Puppet/Skeleton3D/R_Foot" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_Thigh" parent="Puppet/Skeleton3D" index="14"]
transform = Transform3D(0.497286, -0.0521418, -0.866018, -0.104669, -0.994507, -0.000225157, -0.86125, 0.0907569, -0.500013, -0.0851499, 0.876024, -0.0593682)

[node name="L_ThighArea" parent="Puppet/Skeleton3D/L_Thigh" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_Shin" parent="Puppet/Skeleton3D" index="15"]
transform = Transform3D(0.492702, -0.0330555, -0.86957, -0.359526, -0.917736, -0.168822, -0.792456, 0.395812, -0.464055, -0.107058, 0.458172, -0.0212358)

[node name="L_ShinArea" parent="Puppet/Skeleton3D/L_Shin" index="0"]
collision_layer = 8
collision_mask = 1

[node name="L_Foot" parent="Puppet/Skeleton3D" index="16"]
transform = Transform3D(0.245938, -0.0720758, -0.966602, 0.853542, -0.456465, 0.251208, -0.459326, -0.886817, -0.0507426, -0.11946, 0.113831, 0.127276)

[node name="L_FootArea" parent="Puppet/Skeleton3D/L_Foot" index="0"]
collision_layer = 8
collision_mask = 1

[node name="TargetTimer" type="Timer" parent="." index="9"]
one_shot = true

[node name="ShootTimer" type="Timer" parent="." index="10"]
one_shot = true

[node name="Debug" type="Node3D" parent="." index="14"]
visible = false

[node name="Box" type="MeshInstance3D" parent="Debug" index="0"]
top_level = true
mesh = SubResource("BoxMesh_tvwkv")

[connection signal="velocity_computed" from="NavAgent" to="." method="avoid_velocity"]
[connection signal="timeout" from="TargetTimer" to="." method="target_lost"]

[editable path="Weapons/Pistol"]
[editable path="Weapons/Pistol/Mesh"]
[editable path="Weapons/SMG"]
[editable path="Weapons/SMG/Mesh"]
[editable path="Weapons/Rifle"]
[editable path="Weapons/Shotgun"]
[editable path="Weapons/Sniper"]
[editable path="Puppet"]
